<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>9. SAC Data Access &mdash; AIMBAT 0.2.1 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/additional_styles.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.2.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="AIMBAT 0.2.1 documentation" href="../index.html" />
    <link rel="next" title="10. Measuring Teleseismic Body Wave Arrival Times" href="PickingTravelTimes.html" />
    <link rel="prev" title="8. Parameter Configuration" href="parameterConfiguration.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="PickingTravelTimes.html" title="10. Measuring Teleseismic Body Wave Arrival Times"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="parameterConfiguration.html" title="8. Parameter Configuration"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">AIMBAT 0.2.1 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="sac-data-access">
<h1>9. SAC Data Access<a class="headerlink" href="#sac-data-access" title="Permalink to this headline">¶</a></h1>
<div class="section" id="python-object-for-sac-file">
<h2>9.1. Python Object for SAC File<a class="headerlink" href="#python-object-for-sac-file" title="Permalink to this headline">¶</a></h2>
<p>The <tt class="docutils literal"><span class="pre">pysmo.sac</span></tt> package is developed to read and write individual SAC files.
The Python class <tt class="docutils literal"><span class="pre">sacfile</span></tt> of module <tt class="docutils literal"><span class="pre">sacio</span></tt> opens a SAC file and returns an object including data and all SAC header variables as its attributes. Modifications of object attributes are saved to file. It is written purely in Python so that it also runs with <a class="reference external" href="http://www.jython.org">Jython</a>.</p>
<div class="section" id="egsac-py">
<h3>9.1.1. <cite>egsac.py</cite><a class="headerlink" href="#egsac-py" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">&lt;pkg-install-dir&gt;/aimbat/scripts/egsac.py</span></tt> script gives a simple example to read, resample and plot a seismogram using pysmo, Scipy and Matplotlib. You can type the codes in a Python/iPython shell, or run as a script in the data example directory <tt class="docutils literal"><span class="pre">&lt;pkg-install-dir&gt;/data-example/example_pkl_files/Event_2011.09.15.19.31.04.080</span></tt>, hereafter refered to as <cite>&lt;example-event-dir&gt;</cite>.</p>
<img alt="../_images/prog-egsac.png" src="../_images/prog-egsac.png" />
</div>
<div class="section" id="resampling-seismograms">
<h3>9.1.2. Resampling Seismograms<a class="headerlink" href="#resampling-seismograms" title="Permalink to this headline">¶</a></h3>
<p>In this example, a SAC file named <tt class="docutils literal"><span class="pre">TA.109C.\_\_.BHZ.sac</span></tt> is read in as a sacfile object. The time array is calculated from SAC headers.  The data array is resampled from interval 0.025 to 2.0 seconds using Scipy&#8217;s signalprocessing module.</p>
<p>Add the following codes to write the resampled seismogram to file <tt class="docutils literal"><span class="pre">TA.109C.\_\_.BHZ.sac</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">sacobj</span><span class="o">.</span><span class="n">delta</span> <span class="o">=</span> <span class="n">deltanew</span>
<span class="n">sacobj</span><span class="o">.</span><span class="n">npts</span> <span class="o">=</span> <span class="n">nptsnew</span>
<span class="n">sacobj</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">y2</span>
</pre></div>
</div>
<img alt="../_images/egsac-109c.png" src="../_images/egsac-109c.png" />
</div>
</div>
<div class="section" id="python-pickle-for-sac-files">
<h2>9.2. Python Pickle for SAC Files<a class="headerlink" href="#python-pickle-for-sac-files" title="Permalink to this headline">¶</a></h2>
<p>The texttt{pysmo.sacio} module converts SAC files to <tt class="docutils literal"><span class="pre">sacfile</span></tt> objects. Any modification of the objects are instantly written to files. In data processing, the user may want to abandon changes made earlier, which brings the need of a buffer for the <tt class="docutils literal"><span class="pre">sacfile</span></tt> objects.</p>
<p>The <tt class="docutils literal"><span class="pre">SacDataHdrs</span></tt> class in the <tt class="docutils literal"><span class="pre">pysmo.aimbat.sacpickle</span></tt> module is written on top of <tt class="docutils literal"><span class="pre">pysmo.sacio</span></tt> to serves this purpose by reading a SAC file and returning a texttt{sacdh} object that is very similar of the <tt class="docutils literal"><span class="pre">sacfile</span></tt> object. Essentially, the <tt class="docutils literal"><span class="pre">sacdh</span></tt> object is a copy of the the texttt{sacfile} object in the memory, except that SAC headers &#8216;t0-t9&#8217;, &#8216;user0-user9&#8217;, &#8216;kuser0-kuser2&#8217; are saved in three Python lists.</p>
<p>A <tt class="docutils literal"><span class="pre">gsac</span></tt> object of the <tt class="docutils literal"><span class="pre">SacGroup</span></tt> class consists of a group of <tt class="docutils literal"><span class="pre">sacdh</span></tt> objects from event-based SAC data files, earthquake hypocenter information and station locations.
An additional step is required to save changes in the <tt class="docutils literal"><span class="pre">gsac</span></tt> object to files.</p>
<p>In order to avoid frequent SAC file I/O, the <tt class="docutils literal"><span class="pre">pickle/cPickle</span></tt> module is used for serializing and de-serializing the <tt class="docutils literal"><span class="pre">gsac</span></tt> object structure. Thus the data processing efficiency is improved because reading and writing of SAC files are done only once each before and after data processing. Script <tt class="docutils literal"><span class="pre">sac2pkl.py</span></tt> does the conversions between SAC files and Python pickles.</p>
<p>Its usage message can be printed out by running at command line:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">sac2pkl</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">h</span>
</pre></div>
</div>
<p>and the result is displayed in the figure below. For example, in the data example directory <tt class="docutils literal"><span class="pre">&lt;example-event-dir&gt;</span></tt>, run:</p>
<div class="highlight-python"><div class="highlight"><pre>sac2pkl.py -s *Z -o 20110915.19310408.bhz.pkl -d 0.025
</pre></div>
</div>
<p>to read 163 vertical component seismograms at a sample interval of 0.025 s and convert to a <tt class="docutils literal"><span class="pre">gsac</span></tt> object which is saved in the pickle file <tt class="docutils literal"><span class="pre">20110915.19310408.bhz.pkl</span></tt>.</p>
<p>To save disk space, compressed pickle files in <tt class="docutils literal"><span class="pre">gz</span></tt> and <tt class="docutils literal"><span class="pre">bz2</span></tt> formats can be generated by:</p>
<div class="highlight-python"><div class="highlight"><pre>sac2pkl.py -s *Z -o 20110915.19310408.bhz.pkl -d 0.025 -z gz
sac2pkl.py -s *Z -o 20110915.19310408.bhz.pkl -d 0.025 -z bz2
</pre></div>
</div>
<p>at the cost of more CPU time.</p>
<p>After processing, run:</p>
<div class="highlight-python"><div class="highlight"><pre>sac2pkl.py 20110915.19310408.bhz.pkl -p
</pre></div>
</div>
<p>to convert the pickle file to SAC files.</p>
<p>..image:: SACdataAccess/help-sac2pkl</p>
<p>See the doc string of <tt class="docutils literal"><span class="pre">pysmo.aimbat.sacpickle</span></tt> by typing in a python console:</p>
<div class="highlight-python"><div class="highlight"><pre>from pysmo.aimbat import sacpickle
print sacpickle.\_\_doc\_\_
</pre></div>
</div>
<p>and also the documentation on <a class="reference external" href="http://docs.python.org/library/pickle.html">pickle</a> for more information about the Python data structure, pickling and unpickling.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/NU_Logo_purple.jpg" alt="Logo"/>
            </a></p>
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">9. SAC Data Access</a><ul>
<li><a class="reference internal" href="#python-object-for-sac-file">9.1. Python Object for SAC File</a><ul>
<li><a class="reference internal" href="#egsac-py">9.1.1. <cite>egsac.py</cite></a></li>
<li><a class="reference internal" href="#resampling-seismograms">9.1.2. Resampling Seismograms</a></li>
</ul>
</li>
<li><a class="reference internal" href="#python-pickle-for-sac-files">9.2. Python Pickle for SAC Files</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="parameterConfiguration.html"
                        title="previous chapter">8. Parameter Configuration</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="PickingTravelTimes.html"
                        title="next chapter">10. Measuring Teleseismic Body Wave Arrival Times</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/docfiles/SACdataAccess.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="PickingTravelTimes.html" title="10. Measuring Teleseismic Body Wave Arrival Times"
             >next</a> |</li>
        <li class="right" >
          <a href="parameterConfiguration.html" title="8. Parameter Configuration"
             >previous</a> |</li>
        <li><a href="../index.html">AIMBAT 0.2.1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, Lay Kuan Loh, Xiaoting Lou &amp; Suzan van der Lee.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>